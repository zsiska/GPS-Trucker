<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Elektronick√° stazka</title>
  <style>
    * {margin:0;padding:0;box-sizing:border-box}
    body {font-family:system-ui,-apple-system,sans-serif;background:#0f172a;color:#e2e8f0;min-height:100vh;display:flex;flex-direction:column}
    
    .header {padding:1rem;background:#1e293b;border-bottom:1px solid #334155}
    .header-top {display:flex;justify-content:space-between;align-items:center;margin-bottom:0.5rem}
    .brand {font-size:1.2rem;font-weight:bold}
    .status {display:flex;gap:1rem;font-size:0.9rem;color:#94a3b8}
    .dot {width:8px;height:8px;border-radius:50%;display:inline-block;margin-right:0.3rem}
    .dot.green {background:#22c55e}
    .dot.yellow {background:#f59e0b}
    .dot.red {background:#ef4444}
    
    .steps {display:flex;gap:0.5rem;flex-wrap:wrap}
    .step {padding:0.3rem 0.6rem;border:1px solid #334155;border-radius:20px;font-size:0.85rem;color:#94a3b8}
    .step.active {background:#3b82f6;color:white;border-color:#3b82f6}
    .step.done {background:#22c55e;color:white;border-color:#22c55e}
    
    .main {flex:1;display:flex;gap:1rem;padding:1rem}
    .left-panel {flex:1;display:flex;flex-direction:column;gap:1rem}
    .right-panel {width:400px;display:flex;flex-direction:column;gap:1rem}
    
    .card {background:#1e293b;border:1px solid #334155;border-radius:8px;padding:1rem}
    .card h2 {font-size:1.1rem;margin-bottom:0.5rem}
    
    .map-container {height:300px;background:#0f172a;border-radius:8px;position:relative;overflow:hidden}
    .vehicle-icon {position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);font-size:24px}
    
    .kpis {display:grid;grid-template-columns:repeat(4,1fr);gap:0.5rem;margin-top:0.5rem}
    .kpi {background:#0f172a;padding:0.5rem;border-radius:6px;text-align:center}
    .kpi-value {font-size:1.5rem;font-weight:bold}
    .kpi-label {font-size:0.75rem;color:#94a3b8}
    
    .form-row {margin-bottom:0.75rem}
    .form-row label {display:block;font-size:0.85rem;color:#94a3b8;margin-bottom:0.25rem}
    .form-row input, .form-row select {width:100%;padding:0.5rem;background:#0f172a;border:1px solid #334155;border-radius:6px;color:#e2e8f0}
    
    .buttons {display:flex;gap:0.5rem;margin-top:1rem}
    .btn {padding:0.5rem 1rem;border:none;border-radius:6px;cursor:pointer;font-weight:500}
    .btn-primary {background:#3b82f6;color:white}
    .btn-secondary {background:#475569;color:white}
    .btn-success {background:#22c55e;color:white}
    .btn-danger {background:#ef4444;color:white}
    .btn:disabled {opacity:0.5;cursor:not-allowed}
    
    .screen {display:none}
    .screen.active {display:block}
    
    .mode-buttons {display:grid;grid-template-columns:repeat(2,1fr);gap:0.5rem}
    .mode-btn {padding:0.75rem;border:1px solid #334155;background:#0f172a;color:#e2e8f0;border-radius:6px;cursor:pointer}
    .mode-btn.active {background:#3b82f6;border-color:#3b82f6}
    
    .info-text {color:#94a3b8;font-size:0.9rem;margin:0.5rem 0}
    
    @media (max-width: 768px) {
      .main {flex-direction:column}
      .right-panel {width:100%}
      .kpis {grid-template-columns:repeat(2,1fr)}
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="header-top">
      <div class="brand">üìç Elektronick√° stazka</div>
      <div class="status">
        <span><span class="dot green"></span>Online</span>
        <span><span class="dot yellow" id="gps-status-dot"></span><span id="gps-status">Simulace</span></span>
        <span id="time">--:--:--</span>
      </div>
    </div>
    <div class="steps">
      <div class="step active" id="step-1">1. √övod</div>
      <div class="step" id="step-2">2. ≈òidiƒç</div>
      <div class="step" id="step-3">3. Start</div>
      <div class="step" id="step-4">4. J√≠zda</div>
      <div class="step" id="step-5">5. Konec</div>
      <div class="step" id="step-6">6. Sum√°≈ô</div>
    </div>
  </div>

  <div class="main">
    <div class="left-panel">
      <div class="card">
        <h2>Mapa a trasa</h2>
        <div class="map-container">
          <div class="vehicle-icon" id="vehicle">üöõ</div>
        </div>
        <div class="kpis">
          <div class="kpi">
            <div class="kpi-value" id="speed">0</div>
            <div class="kpi-label">km/h</div>
          </div>
          <div class="kpi">
            <div class="kpi-value" id="distance">0.0</div>
            <div class="kpi-label">km</div>
          </div>
          <div class="kpi">
            <div class="kpi-value" id="odometer">0</div>
            <div class="kpi-label">tachometr</div>
          </div>
          <div class="kpi">
            <div class="kpi-value" id="duration">0:00</div>
            <div class="kpi-label">ƒças j√≠zdy</div>
          </div>
        </div>
      </div>
      
      <div class="card">
        <h2>Stav</h2>
        <div class="form-row">
          <label>Aktu√°ln√≠ re≈æim</label>
          <input type="text" id="current-mode" disabled value="P≈ôipraven">
        </div>
        <div class="form-row">
          <label>GPS sou≈ôadnice</label>
          <input type="text" id="gps-coords" disabled value="50.0755, 14.4378">
        </div>
        <div class="buttons">
          <button class="btn btn-primary" id="btn-simulate">Simulovat j√≠zdu</button>
          <button class="btn btn-danger" id="btn-end-trip" disabled>Ukonƒçit stazku</button>
        </div>
      </div>
    </div>

    <div class="right-panel">
      <!-- Screen 1: Intro -->
      <div class="card screen active" id="screen-1">
        <h2>V√≠tejte</h2>
        <p class="info-text">Syst√©m pro evidenci j√≠zd a stazek. Zaƒçnƒõte vyplnƒõn√≠m √∫daj≈Ø o ≈ôidiƒçi.</p>
        <div class="buttons">
          <button class="btn btn-primary" onclick="goToStep(2)">Zaƒç√≠t</button>
        </div>
      </div>

      <!-- Screen 2: Driver -->
      <div class="card screen" id="screen-2">
        <h2>√ödaje o ≈ôidiƒçi</h2>
        <div class="form-row">
          <label>Jm√©no ≈ôidiƒçe</label>
          <input type="text" id="driver-name" placeholder="Jan Nov√°k">
        </div>
        <div class="form-row">
          <label>ID ≈ôidiƒçe</label>
          <input type="text" id="driver-id" placeholder="12345">
        </div>
        <div class="form-row">
          <label>RZ vozidla</label>
          <input type="text" id="vehicle-plate" placeholder="1A2 3456">
        </div>
        <div class="buttons">
          <button class="btn btn-secondary" onclick="goToStep(1)">Zpƒõt</button>
          <button class="btn btn-primary" onclick="saveDriver()">Pokraƒçovat</button>
        </div>
      </div>

      <!-- Screen 3: Trip Start -->
      <div class="card screen" id="screen-3">
        <h2>Zah√°jen√≠ stazky</h2>
        <div class="form-row">
          <label>ƒå√≠slo stazky</label>
          <input type="number" id="trip-number" value="1">
        </div>
        <div class="form-row">
          <label>Start m√≠sto</label>
          <input type="text" id="start-place" value="Praha">
        </div>
        <div class="form-row">
          <label>Tachometr (km)</label>
          <input type="number" id="start-odo" value="0">
        </div>
        <div class="form-row">
          <label>N√°klad</label>
          <input type="text" id="cargo" placeholder="Popis n√°kladu">
        </div>
        <div class="buttons">
          <button class="btn btn-secondary" onclick="goToStep(2)">Zpƒõt</button>
          <button class="btn btn-success" onclick="startTrip()">Zah√°jit stazku</button>
        </div>
      </div>

      <!-- Screen 4: Driving -->
      <div class="card screen" id="screen-4">
        <h2>Re≈æim j√≠zdy</h2>
        <p class="info-text">Vyberte aktu√°ln√≠ ƒçinnost:</p>
        <div class="mode-buttons">
          <button class="mode-btn" data-mode="driving" onclick="setMode('driving')">üöõ J√≠zda</button>
          <button class="mode-btn" data-mode="loading" onclick="setMode('loading')">üì¶ Nakl√°dka</button>
          <button class="mode-btn" data-mode="unloading" onclick="setMode('unloading')">üì§ Vykl√°dka</button>
          <button class="mode-btn" data-mode="break" onclick="setMode('break')">‚òï P≈ôest√°vka</button>
        </div>
        <div class="buttons" style="margin-top:1rem">
          <button class="btn btn-danger" onclick="goToStep(5)">Ukonƒçit stazku</button>
        </div>
      </div>

      <!-- Screen 5: End -->
      <div class="card screen" id="screen-5">
        <h2>Ukonƒçen√≠ stazky</h2>
        <div class="form-row">
          <label>Koneƒçn√© m√≠sto</label>
          <input type="text" id="end-place" value="Brno">
        </div>
        <div class="form-row">
          <label>Tachometr (km)</label>
          <input type="number" id="end-odo">
        </div>
        <div class="form-row">
          <label>Palivo (l)</label>
          <input type="number" id="fuel" step="0.1">
        </div>
        <div class="buttons">
          <button class="btn btn-secondary" onclick="goToStep(4)">Zpƒõt</button>
          <button class="btn btn-success" onclick="finishTrip()">Ulo≈æit a zobrazit sum√°≈ô</button>
        </div>
      </div>

      <!-- Screen 6: Summary -->
      <div class="card screen" id="screen-6">
        <h2>Sum√°≈ô stazky</h2>
        <div id="summary-content"></div>
        <div class="buttons">
          <button class="btn btn-primary" onclick="newTrip()">Nov√° stazka</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // State management
    let state = {
      currentStep: 1,
      tripActive: false,
      tripData: {},
      currentMode: 'idle',
      startTime: null,
      odometer: 0,
      distance: 0,
      speed: 0,
      simulating: false,
      simulationInterval: null
    };

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      updateClock();
      setInterval(updateClock, 1000);
      loadSavedData();
    });

    function updateClock() {
      document.getElementById('time').textContent = new Date().toLocaleTimeString('cs-CZ');
    }

    function goToStep(step) {
      // Hide all screens
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      // Show selected screen
      document.getElementById(`screen-${step}`).classList.add('active');
      
      // Update step indicators
      document.querySelectorAll('.step').forEach((s, i) => {
        s.classList.remove('active', 'done');
        if (i + 1 < step) s.classList.add('done');
        if (i + 1 === step) s.classList.add('active');
      });
      
      state.currentStep = step;
      
      // Special actions for certain steps
      if (step === 5) {
        document.getElementById('end-odo').value = Math.round(state.odometer);
      }
    }

    function saveDriver() {
      const name = document.getElementById('driver-name').value;
      const id = document.getElementById('driver-id').value;
      const plate = document.getElementById('vehicle-plate').value;
      
      if (!name || !plate) {
        alert('Vypl≈àte jm√©no ≈ôidiƒçe a RZ vozidla');
        return;
      }
      
      state.tripData.driverName = name;
      state.tripData.driverId = id;
      state.tripData.vehiclePlate = plate;
      
      localStorage.setItem('driverData', JSON.stringify({name, id, plate}));
      goToStep(3);
    }

    function startTrip() {
      state.tripData.tripNumber = document.getElementById('trip-number').value;
      state.tripData.startPlace = document.getElementById('start-place').value;
      state.tripData.startOdo = parseInt(document.getElementById('start-odo').value) || 0;
      state.tripData.cargo = document.getElementById('cargo').value;
      state.tripData.startTime = new Date();
      
      state.odometer = state.tripData.startOdo;
      state.tripActive = true;
      state.startTime = Date.now();
      
      document.getElementById('btn-end-trip').disabled = false;
      document.getElementById('current-mode').value = 'J√≠zda zah√°jena';
      
      goToStep(4);
      setMode('driving');
    }

    function setMode(mode) {
      state.currentMode = mode;
      
      // Update UI
      document.querySelectorAll('.mode-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.mode === mode) {
          btn.classList.add('active');
        }
      });
      
      const modeNames = {
        'driving': 'J√≠zda',
        'loading': 'Nakl√°dka',
        'unloading': 'Vykl√°dka',
        'break': 'P≈ôest√°vka'
      };
      
      document.getElementById('current-mode').value = modeNames[mode] || mode;
    }

    function finishTrip() {
      state.tripData.endPlace = document.getElementById('end-place').value;
      state.tripData.endOdo = parseInt(document.getElementById('end-odo').value) || state.odometer;
      state.tripData.fuel = document.getElementById('fuel').value;
      state.tripData.endTime = new Date();
      state.tripData.distance = state.distance;
      
      // Stop simulation if running
      if (state.simulating) {
        toggleSimulation();
      }
      
      // Generate summary
      const summary = `
        <div style="line-height: 1.6">
          <p><strong>Stazka ƒç.:</strong> ${state.tripData.tripNumber}</p>
          <p><strong>≈òidiƒç:</strong> ${state.tripData.driverName}</p>
          <p><strong>Vozidlo:</strong> ${state.tripData.vehiclePlate}</p>
          <p><strong>Trasa:</strong> ${state.tripData.startPlace} ‚Üí ${state.tripData.endPlace}</p>
          <p><strong>Vzd√°lenost:</strong> ${state.distance.toFixed(1)} km</p>
          <p><strong>Tachometr:</strong> ${state.tripData.startOdo} ‚Üí ${state.tripData.endOdo} km</p>
          <p><strong>ƒåas:</strong> ${state.tripData.startTime.toLocaleString('cs-CZ')} - ${state.tripData.endTime.toLocaleString('cs-CZ')}</p>
          <p><strong>N√°klad:</strong> ${state.tripData.cargo || '-'}</p>
          <p><strong>Palivo:</strong> ${state.tripData.fuel || '-'} l</p>
        </div>
      `;
      
      document.getElementById('summary-content').innerHTML = summary;
      
      // Save to localStorage
      const trips = JSON.parse(localStorage.getItem('trips') || '[]');
      trips.push(state.tripData);
      localStorage.setItem('trips', JSON.stringify(trips));
      
      // Reset state
      state.tripActive = false;
      document.getElementById('btn-end-trip').disabled = true;
      
      goToStep(6);
    }

    function newTrip() {
      state.distance = 0;
      state.tripData = {};
      document.getElementById('distance').textContent = '0.0';
      document.getElementById('speed').textContent = '0';
      document.getElementById('duration').textContent = '0:00';
      goToStep(3);
    }

    function loadSavedData() {
      const driverData = JSON.parse(localStorage.getItem('driverData') || '{}');
      if (driverData.name) {
        document.getElementById('driver-name').value = driverData.name;
        document.getElementById('driver-id').value = driverData.id || '';
        document.getElementById('vehicle-plate').value = driverData.plate || '';
      }
      
      const trips = JSON.parse(localStorage.getItem('trips') || '[]');
      document.getElementById('trip-number').value = trips.length + 1;
    }

    // Simulation
    document.getElementById('btn-simulate').addEventListener('click', toggleSimulation);
    
    function toggleSimulation() {
      state.simulating = !state.simulating;
      
      if (state.simulating) {
        document.getElementById('btn-simulate').textContent = 'Zastavit simulaci';
        document.getElementById('gps-status').textContent = 'Simulace aktivn√≠';
        document.getElementById('gps-status-dot').className = 'dot green';
        
        state.simulationInterval = setInterval(() => {
          if (state.currentMode === 'driving' && state.tripActive) {
            // Simulate speed between 30-80 km/h
            state.speed = 30 + Math.random() * 50;
            const kmPerSecond = state.speed / 3600;
            state.distance += kmPerSecond;
            state.odometer += kmPerSecond;
            
            // Update UI
            document.getElementById('speed').textContent = Math.round(state.speed);
            document.getElementById('distance').textContent = state.distance.toFixed(1);
            document.getElementById('odometer').textContent = Math.round(state.odometer);
            
            // Update duration
            if (state.startTime) {
              const elapsed = Math.floor((Date.now() - state.startTime) / 1000);
              const hours = Math.floor(elapsed / 3600);
              const minutes = Math.floor((elapsed % 3600) / 60);
              document.getElementById('duration').textContent = `${hours}:${minutes.toString().padStart(2, '0')}`;
            }
            
            // Move vehicle icon randomly
            const vehicle = document.getElementById('vehicle');
            const currentLeft = parseFloat(vehicle.style.left || '50');
            const currentTop = parseFloat(vehicle.style.top || '50');
            vehicle.style.left = Math.max(10, Math.min(90, currentLeft + (Math.random() - 0.5) * 2)) + '%';
            vehicle.style.top = Math.max(10, Math.min(90, currentTop + (Math.random() - 0.5) * 2)) + '%';
          } else {
            state.speed = 0;
            document.getElementById('speed').textContent = '0';
          }
        }, 1000);
      } else {
        document.getElementById('btn-simulate').textContent = 'Simulovat j√≠zdu';
        document.getElementById('gps-status').textContent = 'Simulace vypnuta';
        document.getElementById('gps-status-dot').className = 'dot yellow';
        
        if (state.simulationInterval) {
          clearInterval(state.simulationInterval);
          state.simulationInterval = null;
        }
        
        state.speed = 0;
        document.getElementById('speed').textContent = '0';
      }
    }
    
    // End trip button handler
    document.getElementById('btn-end-trip').addEventListener('click', () => goToStep(5));
  </script>
</body>
</html>
